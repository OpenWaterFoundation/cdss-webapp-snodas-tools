<!-- 

This website provides access to a historical archive of SNODAS data products for Colorado water supply basins. 
Snow Data Assimilation System (SNODAS) data are processed daily to calculate Snow Water Equivalent (SWE) and Snow Coverage statistics for water supply basins in Colorado. 
Snow Water Equivalent is the estimate of the depth of liquid water contained within the snowpack. 
Snow coverage is a percent of the basin land surface covered by snow (water bodies in the basin are ignored). 
The national SNODAS gridded dataset has been processed to provide data products for Colorado. 
Mean SWE is displayed in the map using a legend similar to the National Weather Service. 
The SNODAS Tools website provides access to an archive of daily products.  

If at anytime there is code that starts with the letter 'L', that is the command used by Leaflet.

Layout:
This website has a header, a nav element, an article element, and an aside element.
The nav element contains a tab that displays an About, Data, and Analysis section. The
article element contains a map displaying SWE data. The nav has two sections: One 
allows users access to an animation that will progress through a range of dates showing
each dates data, and the other shows graphs of SWE data when a basin has been selected.
-->
<html>
<head>
    <title> SNODAS Daily SWE and Snow Coverage Statistics </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Include css files and a favicon icon -->
    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/style.css"/>
    <link rel="stylesheet" href="css/L.Control.MousePosition.css"/>
    <link rel="stylesheet" href="css/leaflet.zoomhome.css"/>
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="images/snodas-tools-favicon.ico"/>

    <!-- Include javascript files -->
    <script src="javascript/leaflet.js"></script>
    <script src="javascript/jquery-2.1.1.min.js"></script>
    <script src="javascript/jquery.min.js"></script>
    <script src="javascript/d3.v4.min.js"></script>
    <script src="javascript/L.Control.MousePosition.js"></script>
    <script src="javascript/leaflet.zoomhome.min.js"></script>
    <script src="javascript/papaparse.js"></script>
</head>

<script>
    /* This function is called when a user resizes the browser. It updates the 
    size of the map and surrounding elements to fit the broswer height and
    width. 
    
    Functionality: each variable is assigned the width 
    of an element. The width is called by the $('element name') command.
    Once the broswer has been resized, the lightbox map will be resized in
    order to properly fit the size. This is calculated using the header_width,
    nav_width, and aside_width variables. 

    TODO: Fix element widths to work properly and resize on load.*/
    function resize_windows() 
    {
        var header_width = $("header").width();
        var nav_width = $("nav").width();
        var article_width = $("article").width();
        var aside_width = $("aside").width();
        var footer_width = $("footer").width();
        /* ASSIGN MAPID */
        $("#mapid").css("width",(header_width-nav_width-aside_width));
    }
</script>

<body onresize='resize_windows()'>
<header>
    <h1>Colorado's Decision Support Systems (CDSS) SNODAS Tools</h1>
</header>

<div id="main">

    <!-- The following code below is used for the navigation bar on the left hand side of the screen.
    Each div is a certain section (ex: About, Data, Analysis) Once a certain tab has been selected the 
    selected div's display will be set to 'active', and the other two divs will be set to 'none'. -->
    <nav id="navbar" style="max-width: 350px; min-width: 350px;">
        <ul>
            <li><a id="aboutTab" class="active" onclick="navbarClick('about',['data','analysis'],'aboutTab');return false;">About</a></li>
            <li><a id="dataTab" class="not-active" onclick="navbarClick('data',['about','analysis'],'dataTab');return false;">Data</a></li>
            <li><a id="analysisTab" class="not-active" onclick="navbarClick('analysis',['about','data'],'analysisTab');return false;">Documentation</a></li>
        </ul>
        <div id="about" class="scroll">
            <!-- The following code below is used in the About tab. This tab is in the left hand side of the website. 
            Once the 'About' tab has been selected, this code will appear. -->
            <h3>Daily SNODAS Snowpack Products for Colorado Water Supply Basins</h3>
            <p>This website provides access to a historical archive of SNODAS data products for Colorado water supply basins. Snow Data Assimilation System (SNODAS) data from the <a href="https://www.nohrsc.noaa.gov/interactive/html/map.html">National Operational Hydrologic Remote Sensing Center (NOHRSC)</a> are processed daily to calculate Snow Water Equivalent (SWE) and Snow Coverage statistics for water supply basins in Colorado. Snow Water Equivalent is the estimate of the depth of liquid water contained within the snowpack. Snow coverage is a percent of the basin land surface covered by snow (water bodies in the basin are ignored). The national SNODAS gridded dataset has been processed to provide data products for Colorado. Mean SWE is displayed in the map using a legend similar to the National Weather Service. The SNODAS Tools website provides access to an archive of daily products.</p>
            <ul>
                <li>The website is best viewed on a widescreen display. If the layout does not clearly show a left panel with tabs, a center panel with map, and a right panel with date and basin selectors, try maximizing to fill the display. <span style="font-weight: bold;">Ctrl and minus</span> can be used to zoom out until the layout shows all components.</li>
                <li>Hover over a basin to see the daily mean SWE value and other daily statistics.</li>
                <li>Use the <span style="font-weight: bold;">Select Date</span> button to display historical data for a specified day.</li>
                <li>Enter animation start and end dates, press <span style="font-weight: bold;">Submit</span>, and then press the play button to view the animation of daily SWE data.</li>
                <li>Click on a basin in the map to select the basin or use the <span style="font-weight: bold;">Select Basin</span> to select from the basin list. Then click on buttons in the lower right to display graphs.</li>
                <li>Once a graph has been opened, click anywhere on the screen to close the graph view and return to the main screen.</li>
                <li>Reposition the map by holding the mouse button down and dragging.</li>
                <li>Zoom in and out of the map using the control in the upper left, or use the mouse wheel.</li>
                <li>Use the <span style="font-weight: bold;">Data</span> tab on the left to access data files.</li>
            </ul>
            <p>&nbsp;</p>
            <p>Development of the SNODAS Tools was funded by the <a href="http://cwcb.state.co.us">Colorado Water Conservation Board</a>.  The tools were developed by the <a href="http://openwaterfoundation.org">Open Water Foundation</a>.
            Project resources are available on the<a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas"> OWF SNODAS project website</a></p>
            <p style="font-weight: bold;">This website is under development with a scheduled completion date of June 30, 2017.  It is likely that changes in the site's functionality and access to data will occur until then.</p>
            <p>Contact: Joe Busto, <a href="mailto:joe.busto@state.co.us">joe.busto@state.co.us</a></p>
            <p>Steve Malers, <a href="mailto:steve.malers@openwaterfoundation.org">steve.malers@openwaterfoundation.org</a></p>
            <p>Website version 1.0.8 (2017-07-17)</p>
            </div>
            <div id="data" class="scroll" style="display: none; min-width: 300px;">

                <p>The national SNODAS data are available from the <a href="https://nsidc.org/data/g02158">Snow Data Assimilation System (SNODAS)</a> and can be viewed at <a href="https://www.nohrsc.noaa.gov/archived_data/">National Operational Hydrologic Remote Sensing Center (NOHRSC)</a>. The SNODAS data are processed into statistical data products by the CDSS SNODAS Tools.</p>

                <h4>Daily Data</h3>

                <p>The output consists of comma-separated-value (CSV) files <span style="font-weight: bold">ByDate</span> (basin data for each day) and <span style="font-weight: bold">ByBasin</span> (historical period for each basin).  Data files can be downloaded by accessing the following URL resources.  The zip file contains a shapefile with daily statistics in the attribute table (attribute names have been truncated to adhere to shapefile limit).</p>

                <p style="font-size: 13px">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByBasin/SnowpackStatisticsByBasin_Local_ID.csv</p>

                <p style="font-size: 13px">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_YYYYMMDD.csv</p>

                <p style="font-size: 13px">Latest Date Example: <a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_LatestDate.csv">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_LatestDate.csv</a></p>

                <p style="font-size: 13px">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_YYYYMMDD.geojson</p>

                <p style="font-size: 13px">Latest Date Example: <a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_LatestDate.geojson">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_LatestDate.geojson</a></p>

                <p style="font-size: 13px">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_YYYYMMDD.zip</p>

                <p style="font-size: 13px">Latest Date Example: <a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_LatestDate.zip">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_LatestDate.zip</a></p>

                <h4>Upstream Total Data Products</h4>

                <p style="font-size: 13px">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_UpstreamTotal_LatestDate.csv</p>

                <p style="font-size: 13px">Latest Date Example: <a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_UpstreamTotal_LatestDate.csv">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_UpstreamTotal_LatestDate.csv</a></p>
                

                <p style="font-size: 13px">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByBasin/SnowpackStatisticsByBasin_UpstreamTotal_BasinID.csv</p>

                <p style="font-size: 13px"><a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByBasin/SnowpackStatisticsByBasin_UpstreamTotal_504.csv">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByBasin/SnowpackStatisticsByBasin_UpstreamTotal_504.csv</a></p>

                <p style="font-size: 13px">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_UpstreamTotal_YYYYMMDD.csv</p>

                <p style="font-size: 13px">Latest Date Example: <a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_UpstreamTotal_20170602.csv">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/SnowpackStatisticsByDate/SnowpackStatisticsByDate_UpstreamTotal_20170602.csv</a></p>


                <h4>Static Data Available for Download</h3>                

                <p style="font-size: 13px"><a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/json/CO_boundary.geojson">http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/json/CO_boundary.geojson</a>    (State of Colorado rectangular boundary)</p>

                <p style="font-size: 13px"><a href="http://projects.openwaterfoundation.org/owf-proj-co-cwcb-2016-snodas/prototype/json/SNODAS_CO_BasinBoundaries.geojson">json/SNODAS_CO_BasinBoundaries.geojson</a>      (basin boundaries, same as daily boundaries)</p>

                <p style="font-size: 13px"><a href="StaticData/SNODAS_CO_BasinBoundaries.zip">StaticData/SNODAS_CO_BasinBoundaries.zip</a> (input basin boundary layer shapefile)</p>

                <p style="font-size: 13px"><a href="StaticData/Watershed_Connectivity_v4.xlsx">StaticData/Watershed_Connectivity_v4.xlsx</a>    (input basin connectivity for total basin calculations)</p>

                <p>Refer to the <a href="http://software.openwaterfoundation.org/cdss-app-snodas-tools-doc-user/">SNODAS Tools User Manual</a> and <a href="http://software.openwaterfoundation.org/cdss-app-snodas-tools-doc-dev/">SNODAS Tools Developer Manual</a> for more information.</p>

                <h6>SNODAS data citation:  
                National Operational Hydrologic Remote Sensing Center. 2004. Snow Data Assimilation System (SNODAS) Data Products at NSIDC, Version 1.  SWE dataset.  Boulder, Colorado USA. NSIDC: National Snow and Ice Data Center. doi: http://dx.doi.org/10.7265/N5TB14TC.  Data are accessed daily, and historical period is also accessed as needed for historical period products.</h6>
            </div>
            <div id="analysis" style="display: none;">
                <h4>Analysis Process</h4>
                <p>SNODAS data are processed into data products using QGIS and Python software as follows:</p>
                <ol>
                    <li>Download daily SNODAS SWE national data.</li>
                    <li>Clip the national data to the extent of the Colorado water supply basin boundaries and save as TIF image.  Basins extend outside of the Colorado boundary.</li>
                    <li>Use the Colorado SNODAS SWE TIF image and water supply basin boundaries to calculate statistics for the basins.  The effective area used in calculations is that of the sum of the SNODAS grid cells, which differs slightly from the original basin boundary area.  SNODAS analysis excludes water bodies.</li>
                    <li>Output results to comma-separated-value (CSV), GeoJSON map layer, and zipped shapefile.   CSV files are generated by basin and by date to facilitate use in the website and by other applications.</li>
                    <li>Process CSV files into time series graph products using CDSS TSTool software.</li>
                    <li>Publish files to this CDSS SNODAS Tools website.</li>
                </ol>
                <p>&nbsp;</p>
                <p>&nbsp;</p>
                <h4>Documentation</h4>
                <p>A summary of the analysis steps are described in the <a href="http://software.openwaterfoundation.org/cdss-app-snodas-tools-doc-user/">SNODAS Tools User Manual</a>. More detailed explanation is provided in the <a href="http://software.openwaterfoundation.org/cdss-app-snodas-tools-doc-dev/">SNODAS Tools Developer Manual</a>.</p>
            </div>

            <script>
                /* navbarClick() is called by the about, data, and
                analysis tabs on the navbar. This will
                set which class is active (which text is highlighted) 
                and then show the proper 'hidden' information that is 
                in the code above. */
                function navbarClick(source, other, source_id)
                {
                    if(source.toString() == "analysis")
                    {
                        $('#analysisTab').removeClass('not-active');
                        $('#analysisTab').addClass('active');
                        $('#aboutTab').removeClass('active')
                        $('#aboutTab').addClass('not-active');
                        $('#dataTab').removeClass('active');
                        $('#dataTab').addClass('not-active');
                    }
                    else if(source.toString() == "data")
                    {
                        $('#dataTab').removeClass('not-active');
                        $('#dataTab').addClass('active');
                        $('#aboutTab').removeClass('active')
                        $('#aboutTab').addClass('not-active');
                        $('#analysisTab').removeClass('active')
                        $('#analysisTab').addClass('not-active');
                                        }
                    else if(source.toString() == "about")
                    {
                        $('#aboutTab').removeClass('not-active')
                        $('#aboutTab').addClass('active');
                        $('#dataTab').removeClass('active');
                        $('#dataTab').addClass('not-active');
                        $('#analysisTab').removeClass('active')
                        $('#analysisTab').addClass('not-active');
                    }
                    for(var index in other)
                    {
                        document.getElementById(other[index]).style.display = "none";
                    }
                    document.getElementById(source).style.display = "block";
                }
            </script>
    </nav>

    <article>
    <!-- This section is the leaflet map section. It contains a legend in the top right of the map, a scale on the bottom left,
    an information legend on the bottom right, and a zoom in/out button in the top left of the map. The below code will create all
    the objects mentioned.   -->
        <div id="mapid" style="min-width: 300px; max-width: 1000px;">
            <script>
                /* Create Leaflet Map */
                var map = L.map('mapid', {zoomControl: false}).setView([38.99, -105.54], 7);
                
                L.tileLayer('https://api.mapbox.com/styles/v1/korysam/cixur5uy7003g2sqwthpjmbxa/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia29yeXNhbSIsImEiOiJjaXd4dDRxbTQwMXRkMm9tZzd5b3BqdTBwIn0.A2EGyNrWG2Lbbd5c-I-94w', {
                    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy;<a href="http://mapbox.com">Mapbox</a>',
                    maxZoom: 18     
                }).addTo(map);

                /* Top Left Corner of Map. Allows for a home button to reset
                to the default zoom. */
                var zoomHome = L.Control.zoomHome();
                zoomHome.addTo(map);

                /* Bottom Right corner. This shows the current lat and long 
                of the mouse cursor. 

                'ยบ' used for the degree character when the latitude and longitude of the 
                cursor is dispalyed. */
                L.control.mousePosition({position: 'bottomright',lngFormatter: function(num) {
                    var direction = (num < 0) ? 'W' : 'E';
                    var formatted = Math.abs(L.Util.formatNum(num, 3)) + 'ยบ ' + direction;
                    return formatted; 
                },
                latFormatter: function(num) {
                    var direction = (num < 0) ? 'S' : 'N';
                    var formatted = Math.abs(L.Util.formatNum(num, 3)) + 'ยบ ' + direction;
                    return formatted;
                }}).addTo(map);

                /* Bottom Right corner. This shows the scale in km and miles of
                the map. */
                L.control.scale({position: 'bottomright',imperial: true}).addTo(map);

                /* getColor is called by the onEachFeature function. This is what controls 
                the color of each basin depending on the  Mean SME data value. 
                This also controls the colors that are shown in the legend. */
                function getColor(d) {
                    if(d == undefined)
                    {
                        return '#000000';
                    }
                    return d < 0.02 ? '#ffffff':
                    d < 0.04 ? '#eff3ff':
                    d < 0.2 ? '#bdd7e7':
                    d < 0.4 ? '#6baed6':
                    d < 1.0 ? '#3182bd':
                    d < 2.0 ? '#08519c':
                    d < 4.0 ? '#49006a':
                    d < 6.0 ? '#7a0177':
                    d < 10.0 ? '#ae017e':
                    d < 20.0 ? '#dd3497':
                    d < 30.0 ? '#f768a1':
                    d < 40.0 ? '#fa9fb5':
                    d < 80.0 ? '#fcc5c0':
                    '#fde0dd';
                }

                /* A GeoJSON layer used to add GeoJSON objects to the leaflet map.
                The geojson variable layer code is as follows L.geoJSON(geojsonFeature).addTo(map); */
                var geojson;

                /* The function below is called when adding the geojson data from the SNODAS files.
                Style controls the fill color of each basin, the weight of the lines surrounding the 
                basin, the color of the lines outlining each basin, and the opacity. */                 
                function setSWELayerStyle(feature){
                    return {
                        fillColor: getColor((feature.properties.SNODAS_SWE_Mean_in == undefined ? feature.properties.SWE_Mean_inches:feature.properties.SNODAS_SWE_Mean_in)),
                        weight: 1, 
                        color: 'black',
                        fillOpacity: 0.60
                    };
                }

                /* This function is used for the CO_boundary style. It sets the weight of the line used
                to border Colorado, the color of that line, and sets the fill opacity to 0. */
                function setStateBoundaryStyle(feature){
                    return {
                    // fillColor: getColor(feature.properties.Mean_inches),
                    weight: 5, 
                    color: 'black',
                    fillOpacity: 0,
                };
                }

                /* This feature is called by the onEachFeature function. It is what allows users to 
                highlight over basins and will pop up a gray line outlining the basin. */   
                var select_basin_call = false;  /* select_basin_call is a boolean value. This is set true when the ClickOnMapItem function is called.
                                                   This boolean value is used to highlight basins and will prevent the highlight to be removed when the
                                                   user "mouseouts" of the basin.*/
                function highlightFeature(e) {
                    select_basin_call = false;
                    var layer = e.target;
                    layer.setStyle({
                        weight: 6,
                        color: '#666',
                        dashArray: '',
                        
                    });

                    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                        layer.bringToFront();
                    }
                    
                    info.update(layer.feature.properties);
                }
                
                /* This function is also called by the onEachFeature function. It is used
                once a basin has been highlighted over, then the user moves the mouse it will
                reset the layer back to the original state. */
                function resetHighlight(e) {
                    if(!e.target.feature.properties.hasBeenSelected)
                    {
                        geojson.resetStyle(e.target);
                        info.update();
                        if(select_basin_call)
                        {
                            var layer = geojson.getLayer(e.target.feature.properties.LOCAL_ID);
                            layer.fireEvent('mouseover');
                            select_basin_call = false;
                        }
                    }
                }
                
                /* This function is called by the onEachFeature function. It is used
                if a user clicks on a basin. Once a basin is selected, the proper SWE graphs
                will be accessible to view. */
                function selectBasin(e) {
                    // map.fitBounds(e.target.getBounds());
                    clickOnMapItem(e.target.feature.properties.LOCAL_ID);
                }

                /* This function is used when adding the SNODAS data from a csv file to the map. It makes every object
                in the data have these certain "properties". So each object will have a mouseover,
                mouseout, and click property. All of these properties allow users to highlight over
                basins, and click on basins to zoom in on  them */
                function onEachFeature(feature, layer) {
                    layer.on({
                        mouseover: highlightFeature,
                        mouseout: resetHighlight,
                        click: selectBasin
                    });
                    layer._leaflet_id = feature.properties.LOCAL_ID;

                }

                /* This function is used to imitate the fire event 'mouseover'.
                It is called when a user selects a basin from the 'Select Basin' button.
                Once a basin is selected this function will imitate a user moving the 
                cursor over a basin. This function takes in a LOCAL_ID and will highlight
                the currently selected basin. */
                var basin_selected = false;     /* basin_selected is a boolean value. This is set true when the ClickOnMapItem function is called.
                                                   This boolean value is used to highlight basins and will prevent the highlight to be removed when the
                                                   user "mouseouts" of the basin.*/
                var old_basin;
                function clickOnMapItem(Local_ID) {
                    if(basin_selected)
                    {
                        var old_layer = geojson.getLayer(old_basin);
                        old_layer.feature.properties.hasBeenSelected = false;
                        old_layer.fireEvent('mouseout');
                    }
                    var id = Local_ID;
                    old_basin = Local_ID;
                    //get target layer by it's id
                    var layer = geojson.getLayer(id);
                    //fire event 'click' on target layer 
                    layer.fireEvent('mouseover');
                    layer.feature.properties.hasBeenSelected = true;
                    SetSNODASPlot(Local_ID);
                    // select_basin_call = true;
                    basin_selected = true;
                }

                /* The below code is used to create the informational legend on the map. 
                info.update is used to call the statistics for each basin. */
                var info = L.control({position: 'bottomleft'});

                info.onAdd = function(map){
                    this._div = L.DomUtil.create('div', 'info');
                    this.update();
                    return this._div;
                };

                /* The code below is what shows up in the Daily Basin Statistics informational
                legend in the bottom left corner of the map. */
                info.update = function(props) {
                    this._div.innerHTML = '<h4> Daily Basin Statistics </h4>' +  (props ? "<br><b>Local Basin Name: </b>" + props.LOCAL_NAME + 
                        "<br><b>Local Basin ID: </b>" + props.LOCAL_ID + "<br>" + "<br><b><u> SWE</b></u>" + "<br><b>Mean: </b>" 
                        + Math.round(props.SNODAS_SWE_Mean_mm).toLocaleString('en-US') + " mm | "
                        + Number(props.SNODAS_SWE_Mean_in).toLocaleString('en-US',{minimumFractionDigits: 1}) + " in"
                        + "<br><b>Effective Area: </b>"
                        + Number(props.SNODAS_EffectiveArea_sqmi).toLocaleString('en-US', {mimumFractionDigits:1}) + " sqmi"
                        + "<br><b>Volume: </b>" 
                        + Math.round(props.SNODAS_SWE_Volume_acft).toLocaleString('en-US') + " acft"
                        + "<br><b>Volume 1 Week Change: </b>"
                        + Math.round(props.SNODAS_SWE_Volume_1WeekChange_acft).toLocaleString('en-US') + " acft"
                        + "<br>" + "<br><b>Snow Cover: </b>" 
                        + Math.round(props.SNODAS_SnowCover_percent).toLocaleString('en-US') + "%"
                        :'Hover over a basin');
                };

                /* This function is called by the legend and will round
                to the hundredths position (two decimal places). */
                function setTwoNumberDecimal(event) {
                    event = parseFloat(event).toFixed(2);
                    return event;
                }

                /* This function is called by the legend and will round
                to the tenths position (one decimal place). */
                function setOneNumberDecimal(event) {
                    event = parseFloat(event).toFixed(1);
                    return event;
                }

                /* This will add the information legend to the leaflet map as a layer. */
                info.addTo(map);    
                
                /* This code below creates the legend on the map. It iterates through
                an array of legend scale values (SWE  in inches). It then adds this to the 
                legend and will create the html code required to do so */
                var legend = L.control({position: 'topright'});

                legend.onAdd = function (map) {

                    var div = L.DomUtil.create('div', 'info legend'),

                    grades = [0,0.02,0.04,0.2,0.4,1,2,4,6,10,20,30,40,80],
                        /* Referenced legend from this website. https://www.nohrsc.noaa.gov/snow_model/images/full/National/nsm_swe/201701/nsm_swe_2017012005_National.jpg
                        grades = [0,0.02,0.04,0.2,0.39,0.98,2,3.9,5.9,9.8,20,30,39,79], */
                        labels = ['<strong>Mean SWE' + '<br>(in)</strong>'],
                        from, to;

                        for (var i = 0; i < grades.length; i++) {
                            from = grades[i];
                            to = grades[i + 1];

                            labels.push(
                                '<i style="background:' + getColor(from + 0) + '"></i>&nbsp; ' +
                                from + (to ? '&ndash;' + to : '+'));
                        }

                        div.innerHTML = labels.join('<br>');
                        return div;
                    };
                    legend.addTo(map);
            </script>
        </div>
    </article>

    <aside>
        <!-- The below code creates a dropdown menu. For further documentation refer to: https://www.w3schools.com/css/css_dropdowns.asp -->

        <div id="animation" style="background-color: #D3D3D3;">
            <div class="dropdown">
                <button onclick="myFunction()" class="dropbtn" style="font-size: 15px;">Select Date</button>&nbsp;<i class="fa fa-question-circle" aria-hidden="true"><span class="tooltiptext" style="height: 50px;">Select a date for map display</span></i>&nbsp;<span id="SNODASTitle" style="font-size: 15px;">SNODAS Date:</span><span id="FileDate" style="font-size: 15px;"></span>
                <div id="myDropdown" class="dropdown-content">
                    <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()" class="search">
                    <div id="ListOfDates">
                        <script>
                            $.ajaxSetup({
                                async: false
                            });
                            var Current_Date, Latest_Date;
                            var text = new Array();
                            /* The text array will contain strings in the format YYYYMMDD */
                            $.get("SnowpackStatisticsByDate/ListOfDates.txt",function(data)
                            {
                                text = data.split('\n');
                                /* Sort the dates in descending order (Most recent day first) */
                                text.sort(function(a, b) {
                                    return b - a;
                                });
                                /* trim each element. For some reason the split keeps the newline
                                delimiter. */
                                for(var date in text)
                                {
                                    text[date] = text[date].trim();
                                }
                                Current_Date = text[0];
                                for(var index = text.length-1; index > 0; index--)
                                {
                                    if(text[index] != "")
                                    {
                                        Latest_Date = text[index];
                                        break;
                                    }
                                }
                                document.getElementById('ListOfDates').appendChild(createDateList(text));
                            });

                            /* createDateList will create a ul, li list that contains all the dates of
                            available geojson files of the SNODAS data */
                            function createDateList(text)
                            {   
                                var list = document.createElement('span');
                                text.forEach(function(result) {
                                    // var item = document.createElement('li');
                                    var a = document.createElement('a');
                                    var date = document.createTextNode(result.substr(0,4) + "-" + result.substr(4,2) + "-" + result.substr(6,2));
                                        a.setAttribute("href","#");
                                        a.setAttribute("onclick", "updateFile(" + result + ");return false;");
                                    a.appendChild(date);
                                    list.appendChild(a);
                                });
                                return list;
                            }
                        </script>
                    </div> 
                </div>
            </div>
            <script>
                /* Grabs the data from CO_boundary.geojson and adds it as a
                layer to the map. This is what creates the big black border around
                Colorado */
                $.getJSON("json/CO_boundary.geojson",function(data){
                    L.geoJSON(data, {style: setStateBoundaryStyle}).addTo(map);
                });

                /* The below code grabs the SNODAS data fromt he fie file SnowpackbyDate_(CURRENT DATE).csv. It then assigns that data/object into the SNODAS_Statistics variable. */
              var SNODAS_FILE = "SnowpackStatisticsByDate/SnowpackStatisticsByDate_" + Current_Date + ".csv";
                var SNODAS_Statistics;
                $.get(SNODAS_FILE, function(data)
                {
                    SNODAS_Statistics = Papa.parse(data, { header: true, skipEmptyLines: true, quotes: true});
                });
                /* The below code grabs the SNODAS data from the file SNODAS_geometry. This file contains data in
                a geojson format that are different points forming each basin's boundaries. This function will extract
                that data and then assign it to the SNODAS_Geometry variable.*/
                var SNODAS_Geometry = (function() {
                    var result;
                    $.getJSON("json/SNODAS_CO_BasinBoundaries.geojson",function(data) {
                        result = data;
                    }); return result;
                })();
                /* This call below merges the Geometry data with the statistics of each basin. 
                It then adds that merged object to the map as a layer allowing users to see
                the SNODAS data visually on the map. */
                geojson = L.geoJson(MergeData(SNODAS_Geometry,SNODAS_Statistics), {style: setSWELayerStyle, onEachFeature: onEachFeature}).addTo(map);


                /* This funtion takes in a SNODAS Geometry geojson array and an array that contains the data from
                the SnowpackStatisticsByDate/YYYYMMDD CSV file that contains data for each basin. Both of the 
                paramaters are arrays and will be iterated using a nested for loop. 
                This function will iterate through and match each basin with its proper data. */
                function MergeData(SNODAS_Geometry, SNODAS_Statistics)
                {
                    for(var index in SNODAS_Geometry.features)
                    {
                        for(var index2 in SNODAS_Statistics["data"])
                        {
                            if(SNODAS_Geometry.features[index]["properties"]["LOCAL_ID"] == SNODAS_Statistics["data"][index2]["LOCAL_ID"])
                            {
                                for(var key in SNODAS_Statistics["data"][index2])
                                {
                                    SNODAS_Geometry.features[index]["properties"][key] = SNODAS_Statistics["data"][index2][key];                                                                        
                                }
                                SNODAS_Geometry.features[index]["properties"]["hasBeenSelected"] = false;
                            }
                        }
                    }
                    return SNODAS_Geometry;
                }

                /* This function is called by the elements in the ul, li list created for the dropdown
                menu. Once called, it will construct the file name and get the data from that SNODAS file.
                This data is than added to the original SNODAS Geometry data file and added to the map as a layer.
                The function will then remove the OLD SNODAS Geometry layer so there will be no overlap on the map. */
                function updateFile(file)
                {
                    var FileName = file.toString();
                    FileName = FileName.substr(0,4) + "-" + FileName.substr(4,2) + "-" + FileName.substr(6,2);
                    file = "SnowpackStatisticsByDate/SnowpackStatisticsByDate_" + file + ".csv";
                    d3.selectAll("#FileDate").text(" " + FileName);
                    geojson.clearLayers();

                    $.get(file, function(data) {
                       data_array = Papa.parse(data, { header: true, skipEmptyLines: true});
                    });
                    geojson.addData(MergeData(SNODAS_Geometry,data_array));
                }
            </script>
            <!-- The below code is the Animation panel. It contains multiple text fields,
            buttons, and an input range object.--> 
            <h3 style="font-size: 17px">SNODAS Animation</h3>
            <form id="sliderInfo">

                <!-- The below code is used for the startdate text field. It sets the default
                text to show YYYY-MM-DD. -->
                <div id="StartDate" style="font-size: 15px;">
                    <script>
                        document.getElementById("StartDate").innerHTML = 
                        'Starting Date: (earliest available date: ' + 
                        Latest_Date.substr(0,4) + '-' + Latest_Date.substr(4,2)
                        + '-' + Latest_Date.substr(6,2) + ')';
                    </script>
                    <br>
                    <!-- Below code creates the helpful information question mark that is next to the text field. -->
                    <input type="text" name="startdate" placeholder="YYYY-MM-DD" required>
                    &nbsp;&nbsp;<i class="fa fa-question-circle" aria-hidden="true"><span class="tooltiptext">The starting date of data you would like to see.<br><br>For example: <ul><li>20161101</li><br><li>2016-11-01</li></ul></span></i>
                    <br><br>
                </div>

                <!-- The below code is used for the enddate text field. It sets the default
                text to show YYYY-MM-DD. -->
                <div id="EndDate" style="font-size: 15px;">
                    <script>
                        document.getElementById("EndDate").innerHTML = 
                        'Ending Date: (latest available date: ' + 
                        Current_Date.substr(0,4) + '-' + Current_Date.substr(4,2)
                        + '-' + Current_Date.substr(6,2) + ')'
                    </script>
                    <br>
                    <!-- Below code creates the helpful information question mark that is next to the text field. -->
                    <input type="text" name="enddate" placeholder="YYYY-MM-DD" required>
                    &nbsp;&nbsp;<i class="fa fa-question-circle" aria-hidden="true"><span class="tooltiptext">The ending date of data you would like to see.<br><br>For example: <ul><li>20161130</li><br><li>2016-11-30</li></ul></span></i>
                    <br><br>
                </div>

                <!-- The below code is used for the Increment days text field. It sets the default
                text to show, "value between 1 and 10". -->
                <span style="font-size: 15px;">Increment (days): (Default is set to 1)</span><br>
                <input type="text" name="incrementsize" placeholder="value between 1 and 10">
                &nbsp;&nbsp;<i class="fa fa-question-circle" aria-hidden="true"><span class="tooltiptext">The increment, in days, for the animation. A value of 1 will display every day's data. A value of 5 will display every fifth day.</span></i>
                <br><br>
                <input type="Submit" value="Submit" style="font-family: Trebuchet MS,Helvetica,sans-serif!important;" onclick="updateSliderMin_Max(this.form.startdate.value, this.form.enddate.value, this.form.incrementsize.value);return false;"/>
            </form>
            <input type="range" id="dateSlider" min="null" max="null" value="" step="1" onchange="showValue(this.value);return false;" style="width: 350px;" disabled>
            <datalist id="datalist">
            </datalist>
            <span id="range"></span>
            <br>
            <input type="Submit" value= &#9658 style="width: 75px;" onclick="PlaySlider()">
            <input type="Submit" value= &#10073;&#10073; style="width: 75px;" onclick="PauseSlider()">
            <input type="Submit" value= &#x21bb; style="width: 75px;" onclick="reload()">
            <script>
                var RangeDates = new Array();
                var range_size, startdate, interval, step, original_startdate;
                var has_complete = false;
                var has_reset = true;
                var iterations = 0;


                /* This is the function the reset button calls. This will reset the 
                range to the beginning date (startdate) and will update certain booleans
                so the animation can run properly */
                function reload()
                {
                    clearInterval(interval);
                    iterations = 0;
                    startdate = original_startdate;
                    document.getElementById("dateSlider").value = startdate;
                    showValue(startdate);
                    has_complete = false;
                    has_reset = true;
                    PlaySlider();
                }
                /* This function is in charge of playing/running the animation
                slider. It will progress through an array of dates that the 
                user inputted (startdate to enddate). Once it has reached the
                end the user must click the reset button in order to play the
                animation again. */
                function PlaySlider()
                {
                    if(has_complete == true)
                    {
                        return false;
                    }
                    if(iterations == 0)
                    {
                        original_startdate = startdate;
                    }
                    if(has_reset == true)
                    {
                        has_reset = false;
                        interval = setInterval(function(){
                        if(iterations % step == 0)
                        {
                            document.getElementById("dateSlider").value = text.indexOf(startdate);
                            showValue(startdate.toString());
                        }
                        iterations++;
                        if(startdate == RangeDates[RangeDates.length-1])
                        {
                            has_complete = true;
                            clearInterval(interval);
                            iterations = 0;
                            return false;
                        }
                        startdate = RangeDates[iterations];
                        },875/step);
                    }
                }

                /* This function is called by the animation pause button. When the pause button 
                is clicked, it wil clear the interval that is created in the PlaySlider() function.
                The interval variable is a timing events. This interval allows execution of code at 
                a specified time interval. This is what pauses the animation */
                function PauseSlider()
                {
                    clearInterval(interval);
                    has_reset = true;
                }

                /* The ShowValue function is called in order to display the current date
                the animation is on. This function will grab the span element with id='range'
                and update it's innerHTML value to equal the current date in the format
                YYYY-MM-DD. */
                function showValue(newValue)
                {
                    document.getElementById("range").innerHTML = newValue.substr(0,4) + "-" + newValue.substr(4,2) + "-" + newValue.substr(6,2);
                    updateFile(newValue);
                }

                /* updateSliderMin_Max is called whenever the animationsubmit button is selected.
                It will update the min and max value of the range animation element.
                This then also creates tick marks on the slidebar by an increment of 
                one. */
                function updateSliderMin_Max(startdate,enddate,scale)
                {
                    if(scale == "")
                    {
                        scale = 1;
                    }
                    iterations = 0;
                    has_complete = false;
                    has_reset = true;
                    clearInterval(interval);
                    RangeDates = [];
                    has_reset = true;
                    /* If the startdate string matches the format YYYY-MM-DD,
                    then the startdate will be updated to match the format
                    YYYYMMDD. This is neccessary when calling the updateFile() function. */
                    if(startdate.match(/^\d{4}\-\d{1,2}\-\d{1,2}$/))
                    {
                        startdate = startdate.replace("-","");
                        startdate = startdate.replace("-","");
                    }
                    /* If the enddate string matches the format YYYY-MM-DD,
                    then the enddate will be updated to match the format
                    YYYYMMDD. This is neccessary when calling the updateFile() function. */
                    if(enddate.match(/^\d{4}\-\d{1,2}\-\d{1,2}$/))
                    {
                        enddate = enddate.replace("-","");
                        enddate = enddate.replace("-","");
                    }

                    step = scale;
                    this.startdate = startdate;
                    range_size = (enddate - startdate) + 1;
                    /* Call updateFile() function to update the current layer displaying on
                    the leaflet map. */
                    updateFile(startdate);



                    /* The below code grabs the span with id "range" and updates the innerhtml to display the 
                    current layers date. It will display below the range animation as YYYY-MM-DD. */
                    document.getElementById("range").innerHTML = startdate.substr(0,4) + "-" + startdate.substr(4,2) + "-" + startdate.substr(6,2);

                    /* datalist is an element that will contain multiple option elements
                    that each contain a date specified in the RangeDates array. */
                    var datalist = document.getElementById('datalist');
                    
                    /* Populate the RangeDates array to contain the dates specified 
                    within the range the user inputted. For example, if the user wanted the range
                    2017-03-01 to 2017-03-05, the RangeDates array would contain the following dates: 
                    2017-03-01, 2017-03-02, 2017-03-03,2017-03-04, 2017-03-05. Also resort the array of
                    dates to be in ascending order. This is so the animation range bar will not act in reverse.*/
                    text.sort(function(a, b) {
                        return a - b;
                    });
                    var start_index = text.indexOf(startdate);
                    var end_index = text.indexOf(enddate);

                    /* The below document.getElementById() code will update the ranges min,
                    max, value, and step values. This is what controls the animation range
                    and step size. The min value is the "startdate", the max value is the "enddate",
                    the scale is the increment days integer. */
                    document.getElementById("dateSlider").min = start_index;
                    document.getElementById("dateSlider").value = start_index;
                    document.getElementById("dateSlider").max = end_index;
                    
                    for(start_index; start_index <= end_index; start_index++)
                    {
                        RangeDates.push(text[start_index]);
                        var option = document.createElement('option');
                        option.appendChild(document.createTextNode(start_index));
                        document.getElementById('datalist').appendChild(option);
                    }
                }

                /* The SNODAS_FILE variable must replace the following text with empty strings. This is done
                so that the proper date format will display next to the SNODAS Date: in the top right corner
                of the website. The format is YYYY-MM-DD. If the SNODAS_File variable does not replace the following
                then the date would display as "SnowpackStatisticsByDate/SnowpackStatisticsByDate_YYYYMMDD.csv". */
                SNODAS_FILE = SNODAS_FILE.replace("SnowpackStatisticsByDate/SnowpackStatisticsByDate_","");
                SNODAS_FILE = SNODAS_FILE.replace(".csv","");
                SNODAS_FILE = SNODAS_FILE.substr(0,4) + "-" + SNODAS_FILE.substr(4,2) + "-" + SNODAS_FILE.substr(6,2);
                d3.select("#FileDate").text(" " + SNODAS_FILE);
             </script>
            </div>
            <br>
            <br>
            <div style="background-color: #D3D3D3">
                <div class="dropdown">
                    <button onclick="myFunction2()" class="dropbtn" style="font-size: 15px;">Select Basin</button>&nbsp;<i class="fa fa-question-circle" aria-hidden="true"><span class="tooltiptext" style="height: 100px;">Select basin for graph display. The basin list includes the basin name and identifier.</span></i><span id="CurrentBasin" style="font-size: 15px;"></span>
                    <div id="myDropdown2" class="dropdown-content">
                        <input type="text" placeholder="Search.." id="myInput2" onkeyup="filterFunction2()" class="search">
                        <div id="BasinList">
                            <script>
                                document.getElementById('BasinList').appendChild(createBasinList());
                                /* createDateList will create a ul, li list that contains all the dates of
                                available geojson files of the SNODAS data */
                                function createBasinList()
                                {   
                                    /* SORT Snodas_Geometry by local name and local id in ascending order A to Z */
                                    SNODAS_Geometry.features.sort(function(a,b){
                                        if (a["properties"]["LOCAL_NAME"].toLowerCase() < b["properties"]["LOCAL_NAME"].toLowerCase()) return -1;
                                        if (a["properties"]["LOCAL_NAME"].toLowerCase() > b["properties"]["LOCAL_NAME"].toLowerCase()) return 1;
                                        if (a["properties"]["LOCAL_NAME"].toLowerCase() == b["properties"]["LOCAL_NAME"].toLowerCase())
                                        {
                                            if (a["properties"]["LOCAL_ID"].toLowerCase() < b["properties"]["LOCAL_ID"].toLowerCase()) return -1;
                                            if (a["properties"]["LOCAL_ID"].toLowerCase() > b["properties"]["LOCAL_ID"].toLowerCase()) return 1;
                                            return
                                        }
                                        return 0;
                                    });
                                    var list = document.createElement('span');
                                    for(var index in SNODAS_Geometry.features)
                                    {
                                        // var li = document.createElement('li');
                                        var a = document.createElement('a');
                                        a.setAttribute("href","#");
                                        a.setAttribute("onclick",'clickOnMapItem(' + '"' + SNODAS_Geometry.features[index]["properties"]["LOCAL_ID"] + '");');
                                        a.setAttribute("style","font-size: 14px;");
                                        var basin = document.createTextNode(SNODAS_Geometry.features[index]["properties"]["LOCAL_NAME"] + " (" + SNODAS_Geometry.features[index]["properties"]["LOCAL_ID"] + ")");
                                        a.appendChild(basin);
                                        list.appendChild(a);
                                    }
                                    return list;
                                }
                            </script>
                        </div>
                    </div>
               </div>
            <br>

           <!-- The BasinID and BasinName span's displays a selected Basins Name and ID underneath the Select
           Basin dropdown menu. Once a basin has been selected, the spans innerHTML will be updated with the proper
           basin name and id. -->
           <span id="BasinID" style="font-size: 15px; font-weight: bold; text-decoration:"></span>
           <br>
           <span id="BasinName" style="font-size: 15px; font-weight: bold; text-decoration:"></span>

            <!-- The code below creates four buttons that are used to display a basins SWE graphs. Once selected, the corresponding
            graph will be displayed on screen. -->
            <br>
            <br>
            <button id="button_one" onclick="document.getElementById('Basin_SnowCover').style.display='inline';" disabled>SNODAS Snow Cover Graph</button>
            <br>
            <br>
            <button id="button_two" onclick="document.getElementById('Basin_SWE').style.display='inline';" disabled>SNODAS SWE Graph</button>
            <br>
            <br>
            <button id="button_three" onclick="document.getElementById('Basin_SWE_Volume').style.display='inline';" disabled>SNODAS SWE Volume Graph</button>
            <br>
            <br>
            <button id="button_four" onclick="document.getElementById('Basin_SWE_Upstream_Total').style.display='inline';" disabled>SNODAS SWE Upstream Total Volume Graph</button>
            <br>
            <br>
            <button id="button_six" onclick="document.getElementById('Basin_Swe_Volume_1WeekChange').style.display='inline';" disabled>SNODAS SWE 1 Week Change Graph</button>
            <br>
            <br>
            <button id="button_seven" onclick="document.getElementById('Basin_Swe_Volume_Gain').style.display='inline';" disabled>SNODAS SWE Volume Gain, Cumulative Graph</button>
            <br>
            <br>
            <button id="button_five" onclick="document.getElementById('Basin_SWE_Upstream_Cumulative').style.display='inline';" disabled>SNODAS SWE Upstream Total Volume Gain, Cumulative Graph</button>

            <!-- The following code creates a lightbox overlay. This will be displayed once a graphs button has been selected. -->
            <div id="Basin_SnowCover" class="lightbox" style="display: none" onclick="document.getElementById('Basin_SnowCover').style.display='none'">
            <span class="close cursor" >&#8592;<span id="close-button-snowcover" style="vertical-align: middle;"></span>
            </span>
                <table class="lightbox_table">
                <tr>
                <td class="lightbox_table_cell" align="center">
                    <div id="lightbox_content">
                        <img id="Basin_SnowCover_img" src="">
                    </div>
                </td>
                </tr>
                </table>
            </div>


            <!-- The below section is used for the lightbox template once a user has selected the 'SNODAS SWE Graph'.
            Once the button has been clicked, the selected basins' SWE Graph will display on the screen. -->
            <div id="Basin_SWE" class="lightbox" style="display: none" onclick="document.getElementById('Basin_SWE').style.display='none'">
            <span class="close cursor" >&#8592;<span id="close-button-swe" style="vertical-align: middle;"></span>
            </span>
                <table class="lightbox_table">
                <tr>
                <td class="lightbox_table_cell" align="center">
                    <div id="lightbox_content">
                        <img id="Basin_SWE_img" src="">
                    </div>
                </td>
                </tr>
                </table>
            </div>


            <!-- The below section is used for the lightbox template once a user has selected the 'SNODAS SWE Volume Graph'.
            Once the button has been clicked, the selected basins' SWE Volume Graph will display on the screen. -->
            <div id="Basin_SWE_Volume" class="lightbox" style="display: none" onclick="document.getElementById('Basin_SWE_Volume').style.display='none'">
            <span class="close cursor" >&#8592;<span id="close-button-swe-volume" style="vertical-align: middle;"></span>
            </span>
                <table class="lightbox_table">
                <tr>
                <td class="lightbox_table_cell" align="center">
                    <div id="lightbox_content">
                        <img id="Basin_SWE_Volume_img" src="">
                    </div>
                </td>
                </tr>
                </table>
            </div>

            <!-- The below section is used for the lightbox template once a user has selected the 'SNODAS SWE Volume Graph'.
            Once the button has been clicked, the selected basins' SWE Volume Graph will display on the screen. -->
            <div id="Basin_SWE_Upstream_Total" class="lightbox" style="display: none" onclick="document.getElementById('Basin_SWE_Upstream_Total').style.display='none'">
            <span class="close cursor" >&#8592;<span id="close-button-swe-upstream-total" style="vertical-align: middle;"></span>
            </span>
                <table class="lightbox_table">
                <tr>
                <td class="lightbox_table_cell" align="center">
                    <div id="lightbox_content">
                        <img id="Basin_SWE_Upstream_Total_img" src="">
                    </div>
                </td>
                </tr>
                </table>
            </div>

            <!-- The below section is used for the lightbox template once a user has selected the 'SNODAS SWE Volume Graph'.
            Once the button has been clicked, the selected basins' SWE Volume Graph will display on the screen. -->
            <div id="Basin_SWE_Upstream_Cumulative" class="lightbox" style="display: none" onclick="document.getElementById('Basin_SWE_Upstream_Cumulative').style.display='none'">
            <span class="close cursor" >&#8592;<span id="close-button-swe-upstream-cumulative" style="vertical-align: middle;"></span>
            </span>
                <table class="lightbox_table">
                <tr>
                <td class="lightbox_table_cell" align="center">
                    <div id="lightbox_content">
                        <img id="Basin_SWE_Upstream_Cumulative_img" src="">
                    </div>
                </td>
                </tr>
                </table>
            </div>

            <!-- The below section is used for the lightbox template once a user has selected the 'SNODAS SWE 1 Week Chnage Graph'.
            Once the button has been clicked, the selected basins' SWE 1 Week Change Graph will display on the screen. -->
            <div id="Basin_Swe_Volume_1WeekChange" class="lightbox" style="display: none" onclick="document.getElementById('Basin_Swe_Volume_1WeekChange').style.display='none'">
            <span class="close cursor" >&#8592;<span id="close-button-swe-volume-change" style="vertical-align: middle;"></span>
            </span>
                <table class="lightbox_table">
                <tr>
                <td class="lightbox_table_cell" align="center">
                    <div id="lightbox_content">
                        <img id="Basin_Swe_Volume_1WeekChange_img" src="">
                    </div>
                </td>
                </tr>
                </table>
            </div>

            <!-- The below section is used for the lightbox template once a user has selected the 'SNODAS SWE Volume Gain, Cumulative Graph'.
            Once the button has been clicked, the selected basins' SWE Volume Gain, Cumulative Graph will display on the screen. -->
            <div id="Basin_Swe_Volume_Gain" class="lightbox" style="display: none" onclick="document.getElementById('Basin_Swe_Volume_Gain').style.display='none'">
            <span class="close cursor" >&#8592;<span id="close-button-swe-volume-gain" style="vertical-align: middle;"></span>
            </span>
                <table class="lightbox_table">
                <tr>
                <td class="lightbox_table_cell" align="center">
                    <div id="lightbox_content">
                        <img id="Basin_Swe_Volume_Gain_img" src="">
                    </div>
                </td>
                </tr>
                </table>
            </div>

            <script>
                /* SetSNODASPlot is called whenever a basin is clicked. Once clicked,
                this function will recieve the LOCAL_ID of that basin and then update
                the SNDOAS Plots image section with the proper plot graph. This will
                then get updated everytime a new basin is selected */
                function SetSNODASPlot(name)
                {
                    document.getElementById("button_one").disabled = false;
                    document.getElementById("button_two").disabled = false;
                    document.getElementById("button_three").disabled = false;
                    document.getElementById("button_four").disabled = false;
                    document.getElementById("button_five").disabled = false;
                    document.getElementById("button_six").disabled = false;
                    document.getElementById("button_seven").disabled = false;


                    document.getElementById("Basin_SnowCover_img").src = "SnowpackGraphsByBasin/" + name + "-SNODAS-SnowCover.png";
                    document.getElementById("close-button-snowcover").innerHTML = "Click anywhere to close graph view"

                    document.getElementById("Basin_SWE_img").src = "SnowpackGraphsByBasin/" + name + "-SNODAS-SWE.png";
                    document.getElementById("close-button-swe").innerHTML = "Click anywhere to close graph view";

                    document.getElementById("Basin_SWE_Volume_img").src = "SnowpackGraphsByBasin/" + name + "-SNODAS-SWE-Volume.png";
                    document.getElementById("close-button-swe-volume").innerHTML = "Click anywhere to close graph view";

                    document.getElementById("Basin_SWE_Upstream_Total_img").src = "SnowpackGraphsByBasin/" + name + "-UpstreamTotal-SNODAS-SWE-Volume.png";
                    document.getElementById("close-button-swe-upstream-total").innerHTML = "Click anywhere to close graph view";

                    document.getElementById("Basin_SWE_Upstream_Cumulative_img").src = "SnowpackGraphsByBasin/" + name + "-UpstreamTotal-SNODAS-SWE-Volume-Gain-Cumulative.png";
                    document.getElementById("close-button-swe-upstream-cumulative").innerHTML = "Click anywhere to close graph view";

                    document.getElementById("Basin_Swe_Volume_1WeekChange_img").src = "SnowpackGraphsByBasin/" + name + "-SNODAS-SWE-Volume-1WeekChange.png";
                    document.getElementById("close-button-swe-volume-change").innerHTML = "Click anywhere to close graph view";

                    document.getElementById("Basin_Swe_Volume_Gain_img").src = "SnowpackGraphsByBasin/" + name + "-SNODAS-SWE-Volume-Gain-Cumulative.png";
                    document.getElementById("close-button-swe-volume-gain").innerHTML = "Click anywhere to close graph view";

                    document.getElementById("BasinID").innerHTML = "Selected Basin ID: " + name;
                    document.getElementById("BasinName").innerHTML = "Basin Name: " + getBasinName(name);

                }

                /* getBasinName takes in a basin id and will search through the 
                SNODAS_Geometry.json file to find the local name of the basin. It will
                then return the local name of the coinciding local id. */
                function getBasinName(id)
                {
                    for(var index in SNODAS_Geometry.features)
                    {
                        if(SNODAS_Geometry.features[index]["properties"]["LOCAL_ID"] == id)
                        {
                            return SNODAS_Geometry.features[index]["properties"]["LOCAL_NAME"];
                        }
                    }
                }
            </script>
            </div>
        </div>
    </aside>
</div>

<script>
    /* The below code is used to close the 'Select Date' and 'Select Basin' dropdown menus.
    When the 'Select Date' or 'Select Basin' menu is open and a user clicks outside of the dropdown
    menu, the dropdown menu will close. */ 
    window.onclick = function(event) {
      if (!event.target.matches('.dropbtn') && !event.target.matches('.search')) {

        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }

    /* Functions used for the dropdown menu. When the user clicks on the button
    toggle between hiding and showing the dropdown content. myFunction selects
    the dropdown element. */
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }

    /* Functions used for the dropdown menu. When the user clicks on the button
    toggle between hiding and showing the dropdown content. myFunction selects
    the dropdown element. */
    function myFunction2() {
        document.getElementById("myDropdown2").classList.toggle("show");
    }

    /* filterFunction is used to grab the list of elements in the dropdown menu.
    This function also allows users to use the search key and will display 
    if there is a matching element. If there is nothing that mathces the search,
    then the function returns nothing and the dropdown menu will show that no elements
    match that search. */
    function filterFunction() {
        var input, filter, a, i;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        div = document.getElementById("myDropdown");
        a = div.getElementsByTagName("a");
        for (i = 0; i < a.length; i++) {
            if (a[i].innerHTML.toUpperCase().indexOf(filter) > -1) {
                a[i].style.display = "";
            } else {
                a[i].style.display = "none";
            }
        }
    }

    /* filterFunction is used to grab the list of elements in the dropdown menu.
    This function also allows users to use the search key and will display 
    if there is a matching element. If there is nothing that mathces the search,
    then the function returns nothing and the dropdown menu will show that no elements
    match that search. */
    function filterFunction2() {
        var input, filter, a, i;
        input = document.getElementById("myInput2");
        filter = input.value.toUpperCase();
        div = document.getElementById("myDropdown2");
        a = div.getElementsByTagName("a");
        for (i = 0; i < a.length; i++) {
            if (a[i].innerHTML.toUpperCase().indexOf(filter) > -1) {
                a[i].style.display = "";
            } else {
                a[i].style.display = "none";
            }
        }
    }
</script>

<footer id="footer">
    <h5>Created by <a href="http://openwaterfoundation.org/">the Open Water Foundation</a> for <a href="http://cwcb.state.co.us/Pages/CWCBHome.aspx">the Colorado Water Conservation Board</a></h5>
</footer>

</body>
</html>
